# 吃豆人 Pac-Man

## 游戏说明

经典吃豆人简化版，FPGA 实现。

### 游戏规则
- **胜利条件**：吃完所有豆子
- **失败条件**：碰到幽灵

### 控制方式

| 按键 | 功能 |
|------|------|
| W | 上 |
| S | 下 |
| A | 左 |
| D | 右 |
| R | 重新开始 |
| ESC | 退出控制程序 |

---

## 技术规格

| 项目 | 规格 |
|------|------|
| 分辨率 | 200×150 (放大4倍到800×600) |
| 刷新率 | 72Hz |
| 迷宫尺寸 | 20×15 格 |
| 格子大小 | 10×10 像素 |
| 幽灵数量 | 2个 |
| 幽灵AI | 简单追踪 |
| 移动方式 | 像素级平滑移动 |

---

## 使用步骤

1. **Vivado 导入文件**
   - 导入所有 `.v` 文件
   - 导入 `pacman.xdc` 约束文件

2. **创建时钟 IP**
   - 创建 `clk_wiz_0` IP
   - 输入 100MHz，输出 50MHz

3. **综合实现**
   - Run Synthesis
   - Run Implementation
   - Generate Bitstream

4. **烧写 FPGA**

5. **运行控制程序**
   ```bash
   python pacman_controller.py
   ```

6. **开始游戏**
   - 按 W/S/A/D 任意键开始

---

## 文件结构

```
pacman/
├── README.md              # 本文档
├── pacman.xdc             # 引脚约束
├── pacman_controller.py   # PC端控制程序
├── pacman_top.v           # 顶层模块
├── pacman_game.v          # 游戏主控（玩家、幽灵、碰撞）
├── pacman_input.v         # 按键解码
├── maze.v                 # 迷宫和豆子
├── uart_rx.v              # 串口接收
├── DST.v                  # VGA时序
└── game_ddp.v             # 像素坐标
```

---

## 迷宫布局

```
####################
#........##........#
#.##.###.##.###.##.#
#..................#
#.##.#.######.#.##.#
#....#........#....#
#.##.###.##.###.##.#
#........##........#
#.##.###.##.###.##.#
#....#........#....#
#.##.#.######.#.##.#
#..................#
#.##.###.##.###.##.#
#........##........#
####################
```

- `#` = 墙壁（蓝色）
- `.` = 豆子（白色）
- 玩家（黄色）初始位置：中下方
- 幽灵（红/粉）初始位置：左上/右上

---

## 颜色说明

| 元素 | 颜色 |
|------|------|
| 背景 | 黑色 |
| 墙壁 | 蓝色 |
| 豆子 | 白色 |
| 玩家 | 黄色 |
| 幽灵1 | 红色 |
| 幽灵2 | 粉色 |
| 胜利提示 | 绿色方块 |
| 失败提示 | 红色方块 |

---

## 可修改参数

### pacman_game.v

```verilog
// 速度（像素/tick）
localparam PLAYER_SPEED = 1;    // 玩家速度
localparam GHOST_SPEED  = 1;    // 幽灵速度

// 玩家初始位置
localparam PLAYER_INIT_X = ...;
localparam PLAYER_INIT_Y = ...;

// 幽灵初始位置
localparam GHOST1_INIT_X = ...;
localparam GHOST2_INIT_X = ...;
```

### maze.v

可修改迷宫布局，每行20位：
```verilog
assign maze_row[0] = 20'b11111111111111111111;  // 1=墙, 0=路
```

---

## 幽灵 AI 说明

简单追踪算法：
1. 在格子中心时选择方向
2. 优先选择朝向玩家的方向
3. 不允许掉头（除非死胡同）
4. 如果首选方向被墙挡住，选其他可行方向

---

祝游戏愉快！🎮
